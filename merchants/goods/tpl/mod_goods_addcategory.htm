<style>
    *{
        margin: 0px;
        padding: 0px;
    }
    body {
        background: white !important;
}
    .layui-layer-btn a {
        width: 46% !important;
    }
</style>
<!--{add_js file="/misc/js/mch_util.js" scope="module"}-->
<!--{add_js file="/misc/js/ext/jquery.form.min.js" scope="module"}-->
<!--{add_css file="/themes/merchants/css/goods.css" scope="module"}-->
<!--{add_js file="/misc/js/fm.js" scope="module"}-->
<!--{add_js file="/misc/js/ext/popup/popup.ext.js" scope="module"}-->
<!--{add_js file="/misc/js/ext/jquery.ajaxfileupload.js" scope="module"}-->
<!--{add_js file="/misc/js/mch.js" scope="module"}-->
<!--{add_js file="/themes/merchants/js/layer.js" scope="module"}-->


    <div class="add_fix">
        <div class="add_name_go">分类名称：<input type="text" value="<!--{$catgory.cat_name}-->"  name="cat_name"></div>
        <div class="add_name_ts">分类名称不能为空且不能多于12个字</div>
        <div class="add_super_go">上级分类：
            <select class="check_s c_goods_type" name="cat_id">
                <option value ="new">请选择</option>
                <!--{foreach from=$goodsList item=val}-->
                <option  <!--{if $val.cat_id==$cat_id && $edit==1}-->selected<!--{/if}--> value ="<!--{$val.cat_id}-->"  ><!--{$val.cat_name}--></option>
                <!--{/foreach}-->
            </select>
        </div>
        <div class="add_img_go">分类图标：</div>
        <div class="add_img img_go_ds">
            <img src="/themes/merchants/img/editor_plus.png" onclick="fileupload();">
            <input type="file" name="file" class="dj_fil" onchange="fileupload(event)">
            <input type="hidden" value="/a/mch/goodscategory" name="cat_url"/>
            <input type="hidden" value="<!--{$cat_id}-->" name="id"/>
        </div>
        <div class="clear"></div>
        <div class="file_sca_img">
            <p>图片支持格式：jpg,png</p>
            <p>请上传尺寸为240*240，文件大小不超过300k的图片</p>
        </div>
        <div class="add_name_go"> 分类排序：<input type="text" name="sort_order" value=""></div>
        <div class="btn_save">保存</div>
    </div>

<script>
    function fileupload(e, obj){
        var url = '/goods/upload_goods_categroy';
        /* popUpload('上传图片', url, function(){
         alert('in..');
         },function(xhr, status, e){
         var msg = "上传失败!";
         if(xhr && xhr.responseText){
         msg = $(xhr.responseText).text();
         }
         alert(msg);
         }); */
        /* F.postWithLoading(url, {}, function(ret){
         if(ret.flag=='SUC'){
         alert('in..');
         }else{
         alert(ret.errMsg);
         }
         }); */
        image_upload(url, e, obj, function(ret){
            /* if(obj){
             var oldDIV = $(obj).closest("div");
             var html =   '<img src="'+thumb+'" data-img="'+img+'">	'
             +' <input type="file" name="file" class="dj_file" onchange="fileupload(event, this);">'
             oldDIV.html(html);
             return;
             }
             var html =   '	<div class="dj_index publish_img">'
             +'		<img src="'+thumb+'" data-img="'+img+'">	'
             +' <input type="file" name="file" class="dj_file" onchange="fileupload(event, this);">'
             +'	</div>';

             $(".publish_image").append(html); */
            console.log(ret);
        });
    }
    $(".btn_save").click(function(){
            this.ding=0;
        if(this.dong==1){
                return;
        }
        var edit="<!--{$edit}-->";
        var  url='/goods/doAddCategory'
        var cat_name =$("input[name=cat_name]").val()
        var cat_url =$("input[name=cat_url]").val()
        var sort_order =$("input[name=sort_order]").val()
        var id =$("input[name=id]").val()
        var cat_id =$(".check_s").val();
        console.log(cat_id);
        console.log(cat_name);
        console.log(cat_url);
        var data={"cat_name":cat_name,"cat_id":cat_id,'cate_thums':cat_url,'sort_order':sort_order,'edit':edit,'id':id};
        $.post(url,data,function(ret){
            if(edit==0 && ret.status==1){
                        layer.closeAll();
                        layer.msg(ret.retmsg);

            }
            if(edit==0 && ret.status==0){
                        layer.msg(ret.retmsg);
            }

       })
    })
</script>